{"version":3,"sources":["../src/scadavis_ctrl.js"],"names":["MetricsPanelCtrl","_","kbn","TimeSeries","legend","SCADAvisCtrl","$scope","$injector","$rootScope","hiddenSeries","panelDefaults","svgurl","showZoomPan","autoResize","zoomLevel","lastZoomLevel","show","values","links","prevDataLength","datasource","maxDataPoints","interval","targets","cacheTimeout","nullPointMode","legendType","breakPoint","aliasColors","format","valueName","strokeWidth","fontSize","_container","defaults","panel","events","on","onRender","bind","onDataReceived","onDataError","onInitEditMode","setLegendWidthForLegacyBrowser","addEditorTab","unitFormats","getUnitFormats","subItem","value","render","series","color","alias","data","parseSeries","svelem","querySelector","svgraph","zoomToOriginal","zoomTo","clientWidth","clientHeight","map","serie","i","label","stats","colors","legendData","_this","fileInput","document","getElementById","addEventListener","e","file","type","reader","FileReader","onload","result","loadURL","readAsDataURL","click","dataList","seriesHandler","templateSrv","replace","scopedVars","console","log","scadavis","container","iframeparams","enableMouse","hideWatermark","enableTools","length","resetData","updateValues","storeValue","seriesData","datapoints","target","flotpairs","getFlotPairs","isNumber","decimals","scaledDecimals","delta","dec","Math","floor","LN10","magn","pow","norm","size","max","decimalInfo","getDecimalsForValue","formatFunc","valueFormats","scope","elem","attrs","ctrl","v","find","lenght","isIE11","window","MSInputMethodContext","documentMode","sideWidth","templateUrl"],"mappings":"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","file":"scadavis_ctrl.js","sourcesContent":["import {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport _ from 'lodash';\nimport kbn from 'app/core/utils/kbn';\nimport TimeSeries from 'app/core/time_series';\n// import rendering from './rendering';\nimport legend from './legend';\nimport 'https://scadavis.io/synoptic/synopticapi.js';\n\nexport class SCADAvisCtrl extends MetricsPanelCtrl {\n\n  constructor($scope, $injector, $rootScope) {\n    super($scope, $injector);\n    this.$rootScope = $rootScope;\n    this.hiddenSeries = {};\n\n    var panelDefaults = {\n      svgurl: 'https://raw.githubusercontent.com/riclolsen/displayfiles/master/helloworld.svg',\n      showZoomPan: false,\n      autoResize: false,\n      zoomLevel: 1.0,\n      lastZoomLevel: -1,\n      legend: {\n        show: true, // disable/enable legend\n        values: true\n      },\n      links: [],\n      prevDataLength: 0,\n      datasource: null,\n      maxDataPoints: 3,\n      interval: null,\n      targets: [{}],\n      cacheTimeout: null,\n      nullPointMode: 'connected',\n      legendType: 'Under graph',\n      breakPoint: '50%',\n      aliasColors: {},\n      format: 'short',\n      valueName: 'current',\n      strokeWidth: 1,\n      fontSize: '80%',\n      _container: null\n    };\n\n    _.defaults(this.panel, panelDefaults);\n    _.defaults(this.panel.legend, panelDefaults.legend);\n\n    this.events.on('render', this.onRender.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n\n    this.setLegendWidthForLegacyBrowser();\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Options', 'public/plugins/scadavis-synoptic-panel/editor.html', 2);\n    this.unitFormats = kbn.getUnitFormats();\n  }\n\n  setUnitFormat(subItem) {\n    this.panel.format = subItem.value;\n    this.render();\n  }\n\n  onDataError() {\n    this.series = [];\n    this.render();\n  }\n\n  changeSeriesColor(series, color) {\n    series.color = color;\n    this.panel.aliasColors[series.alias] = series.color;\n    this.render();\n  }\n\n  onRender() {\n    this.data = this.parseSeries(this.series);\n    var svelem = this.panel._container.querySelector('.scadavis-panel__chart');\n    if (svelem && svelem.svgraph && this.panel.autoResize) {\n      svelem.svgraph.zoomToOriginal();\n      svelem.svgraph.zoomTo(this.panel.zoomLevel * \n          ((svelem.clientWidth < svelem.clientHeight)?svelem.clientWidth/250 : svelem.clientHeight/250) );\n      }     \n  }\n\n  parseSeries(series) {\n    return _.map(this.series, (serie, i) => {\n      return {\n        label: serie.alias,\n        data: serie.stats[this.panel.valueName],\n        color: this.panel.aliasColors[serie.alias] || this.$rootScope.colors[i],\n        legendData: serie.stats[this.panel.valueName],\n      };\n    });\n  }\n\n  onLoadSVGFromFile(){\n    var _this = this;\n    var fileInput = document.getElementById(\"fileInput\");    \n    if (fileInput){\n       fileInput.addEventListener('change', function (e) {\n         var file = fileInput[\"files\"][0];\n         if (file.type == \"image/svg+xml\") {\n           var reader = new FileReader();\n           reader.onload = function (e) {\n              _this.panel.svgurl = reader.result;\n              var svelem = _this.panel._container.querySelector('.scadavis-panel__chart');\n              svelem.svgraph.loadURL(_this.panel.svgurl);\n              _this.panel.lastZoomLevel = -1;\n           }\n         }\n      reader.readAsDataURL(file);\n      })\n    }\n    fileInput.click();\n  }\n\n  onDataReceived(dataList) {\n    this.series = dataList.map(this.seriesHandler.bind(this));\n    this.data = this.parseSeries(this.series);\n    this.render(this.data);\n\t\n    var svgurl = this.panel.svgurl\n    try {\n      svgurl = this.templateSrv.replace(this.panel.svgurl, this.panel.scopedVars, 'html');\n      }\n    catch (e) {\n      console.log('panel error: ', e);\n      }\n\t\t\n    if ( this.panel._container ) {\n      var svelem = this.panel._container.querySelector('.scadavis-panel__chart');\n\n      if ( svelem && !svelem.svgraph ) {      \n        svelem.svgraph = new scadavis({ svgurl: svgurl, \n                                        container: this.panel._container.querySelector('.scadavis-panel__chart'), \n                                        iframeparams: 'frameborder=\"0\" width=\"100%\" height=\"100%\" style=\"overflow:hidden;height:100%;width:100%;\" '\n                                      });\n        svelem.svgraph.enableMouse(false, false);\n        svelem.svgraph.zoomTo(this.panel.zoomLevel);\n        svelem.svgraph.hideWatermark();\n        this.panel.lastZoomLevel = -1;\n        }\n\n      if (svelem.svgraph) {\n        if ( this.panel.lastZoomLevel != this.panel.zoomLevel ) {  \n          svelem.svgraph.zoomToOriginal();\n          if (this.panel.autoResize)\n            svelem.svgraph.zoomTo(this.panel.zoomLevel * ( (svelem.clientWidth < svelem.clientHeight)?svelem.clientWidth/250: svelem.clientHeight/250) );\n          else\n            svelem.svgraph.zoomTo(this.panel.zoomLevel);\n          this.panel.lastZoomLevel = this.panel.zoomLevel;          \n          }\n\t\t\n        if ( svelem.svgraph.svgurl != svgurl ) {\n           svelem.svgraph.loadURL(svgurl);\n           this.panel.lastZoomLevel = -1;\n           }        \n          svelem.svgraph.enableTools(this.panel.showZoomPan, this.panel.showZoomPan);\n        if ( typeof  this.panel.prevDataLength == \"number\" )\n          if ( this.data.length < this.panel.prevDataLength ) {\n            svelem.svgraph.resetData();\n            svelem.svgraph.updateValues();\n          }\n        this.panel.prevDataLength = this.data.length;\n        for (var i=0; i<this.data.length; i++) {\n          svelem.svgraph.storeValue(this.data[i].label, this.data[i].data, 0, 0, this.data[i].label); \n          svelem.svgraph.storeValue(\"@\"+(i+1), this.data[i].data, 0, 0, this.data[i].label);\n          }\n        svelem.svgraph.updateValues();\n      }\n    }\n  }\n\n  seriesHandler(seriesData) {\n    var series = new TimeSeries({\n      datapoints: seriesData.datapoints,\n      alias: seriesData.target\n    });\n\n    series.flotpairs = series.getFlotPairs(this.panel.nullPointMode);\n    return series;\n  }\n\n  getDecimalsForValue(value) {\n    if (_.isNumber(this.panel.decimals)) {\n      return { decimals: this.panel.decimals, scaledDecimals: null };\n    }\n\n    var delta = value / 2;\n    var dec = -Math.floor(Math.log(delta) / Math.LN10);\n\n    var magn = Math.pow(10, -dec);\n    var norm = delta / magn; // norm is between 1.0 and 10.0\n    var size;\n\n    if (norm < 1.5) {\n      size = 1;\n    } else if (norm < 3) {\n      size = 2;\n      // special case for 2.5, requires an extra decimal\n      if (norm > 2.25) {\n        size = 2.5;\n        ++dec;\n      }\n    } else if (norm < 7.5) {\n      size = 5;\n    } else {\n      size = 10;\n    }\n\n    size *= magn;\n\n    // reduce starting decimals if not needed\n    if (Math.floor(value) === value) { dec = 0; }\n\n    var result = {};\n    result.decimals = Math.max(0, dec);\n    result.scaledDecimals = result.decimals - Math.floor(Math.log(size) / Math.LN10) + 2;\n\n    return result;\n  }\n\n  formatValue(value) {\n    var decimalInfo = this.getDecimalsForValue(value);\n    var formatFunc = kbn.valueFormats[this.panel.format];\n    if (formatFunc) {\n      return formatFunc(value, decimalInfo.decimals, decimalInfo.scaledDecimals);\n    }\n    return value;\n  }\n\n  link(scope, elem, attrs, ctrl) {\n    var v = elem.find('.panel-height-helper');\n    if (v.length > 0)\n      this.panel._container = v[0];\n    else v = elem.find('.panel.container');\n    if (v.lenght > 0)\n      this.panel._container = v[0];\n    // rendering(scope, elem, attrs, ctrl);\n  }\n\n  toggleSeries(serie) {\n    if (this.hiddenSeries[serie.label]) {\n      delete this.hiddenSeries[serie.label];\n    } else {\n      this.hiddenSeries[serie.label] = true;\n    }\n    this.render();\n  }\n\n  onLegendTypeChanged() {\n    this.setLegendWidthForLegacyBrowser();\n    this.render();\n  }\n\n  setLegendWidthForLegacyBrowser() {\n    var isIE11 = !!window.MSInputMethodContext && !!document.documentMode;\n    if (isIE11 && this.panel.legendType === 'Right side' && !this.panel.legend.sideWidth) {\n      this.panel.legend.sideWidth = 150;\n    }\n  }\n}\n\nSCADAvisCtrl.templateUrl = 'module.html';\n"]}